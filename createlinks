#!/usr/bin/perl -w

use esmith::Build::CreateLinks qw(:all);
use File::Basename;
use File::Path;

foreach (qw(FaxNotify FaxAccounting FaxDispatch))
{
    safe_symlink("/etc/e-smith/templates-default/template-begin-shell",
        "root/etc/e-smith/templates/var/spool/hylafax/etc/$_/template-begin");
}


safe_symlink("/var/spool/hylafax/bin/ps2fax.gs", "root/var/spool/hylafax/bin/ps2fax");
safe_symlink("/var/spool/hylafax/bin/pdf2fax.gs", "root/var/spool/hylafax/bin/pdf2fax");


# Expand hosts.hfaxd

templates2events("/var/spool/hylafax/etc/hosts.hfaxd",
			qw(
				interface-update
				network-create
				network-delete
			));


#--------------------------------------------------
# actions for nethserver-hylafax-update event
#--------------------------------------------------

my $event = "nethserver-hylafax-update";

event_actions($event,
              'initialize-default-databases' => '00',
              'nethserver-hylafax-conf' => '02',
#              'init-reload' => 10,
              'firewall-adjust' => '30',
              'runlevel-adjust' => '40');

templates2events("/var/spool/hylafax/etc/config",$event);
templates2events("/var/spool/hylafax/etc/FaxAccounting",$event);
templates2events("/var/spool/hylafax/etc/hosts.hfaxd",$event);
templates2events("/var/spool/hylafax/etc/FaxDispatch",$event);
templates2events("/var/spool/hylafax/etc/FaxNotify",$event);
templates2events("/var/spool/hylafax/etc/config.nethesis",$event);
templates2events("/etc/hylafax/hyla.conf",$event);

event_services($event, 'hylafax' => 'restart');


#--------------------------------------------------
# actions for nethserver-hylafax-save event
#--------------------------------------------------

$event = "nethserver-hylafax-save";

event_services($event, 'ejabberd' => 'restart');
event_services($event, 'httpd' => 'reload');
#templates2events("/etc/ejabberd/ejabberd.cfg",  $event);

#--------------------------------------------------
# actions for nethserver-hylafax-uninstall event
#--------------------------------------------------

$event = "nethserver-hylafax-uninstall";

event_actions($event,
              'nethserver-ejabberd-uninstall' => '02',
              'firewall-adjust' => '40',
              'runlevel-adjust' => '50');

templates2events("/etc/ejabberd/ejabberd.cfg",  $event);


